language: php
php:
    - 5.6
    - 7.2
    - 7.3
    - 7.4
os:
    - linux
services:
    - mysql
addons:
    apt:
        sources:
        - mysql-5.7-trusty
        packages:
        - dpkg
        - mysql-server
        - mysql-client
    sonarcloud:
        organization: "webfiori"
        token:
            secure: wSrJaF13aytpJW5sD3YLC1ZeqO3YULnTiHIiA7Qv3AFWNeo11BOx+53d13dCeWD2g2bOYbbulz3/crrn3EzY1uHaGcsyW258ttVMOLwa5V7L22ZVRmHqqdB5HHDnN9QlNVl/GOI+a9i1GRN3Gc/7nF14WmwZPV9kPcV3bfs4ySLwWd+lvIWt9mTz9/DZWnNZ3kAUr8eQnoVOFGte/i38tWHcpFAbeTOpfWOzPD+L2ci6I7Fe54r3LADnQeWpNBo/I6NomreJzDP5EMPoTfJciI8EVHScfu/VH0NEPGgybMFeA8KfhZUpI26cH4CQN+L07mxaIaPyhgTu3dql2HfPTrlyBRUgDGvfvVN6wOExdW7sr2ZdU3TzxA2pkOiPMtd166ga4287IkKppCeRuZVgL3CBwis5obXlo5WbgPM0HyElx5v4KwcQlvsWsqtRjykooLcvuZ1nsuQDkhEl98mhxMgkf+6esI30RNqDHRFFjgVMm7dFk4jF2LpPNw2UYnfF+4hV469SiyEJ9xxqlmMxUfUwJe3/2ZjykFuLLJ9f82ONHtJpLTZc99nR9HpxiV7nF+3jDvFXOjPN/FglqxUG8STPSTkfLUAkncdh75Hzs6gsXwLsTQmntlFvfwRHhxMemTxBbrF0b/+BHP7HfJtbK0EhNtH3XJ/STtDaHUFL6jk=
    
install:
    - sudo apt-get -y -q -m --no-install-suggests --no-install-recommends --allow-unauthenticated
      $(travis_apt_get_options) install dpkg mysql-server mysql-client
before_install:
    - sudo apt-get -q update
    - sudo apt-get -y install postfix
    - mysql -e 'create database if not exists testing_db;'
    - sudo mysql -e "use mysql; update user set authentication_string=PASSWORD('123456')
      where User='root'; update user set plugin='mysql_native_password';FLUSH PRIVILEGES;"
    - sudo mysql_upgrade -u root -p123456
    - sudo service mysql restart
before_script:
    - composer self-update
    - composer install --prefer-source --no-interaction
script:
    - phpunit --verbose --configuration phpunit.xml
after_success:
    - mysql -e 'drop database testing_db;'
    - bash <(curl -s https://codecov.io/bash)
    - sonar-scanner
